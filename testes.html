<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Livraria Prometeu â€” Descubra E-books Gratuitos</title>
  <meta name="description" content="ColeÃ§Ã£o gratuita da Prometeu. ClÃ¡ssicos e descobertas para ler agora." />
  <meta name="keywords" content="ebooks gratuitos, clÃ¡ssicos, leitura, Livraria Prometeu" />
  <link rel="icon" href="https://livrariaprometeu.com/03_MIDIA/logos/livraria_prometeu_original.webp" type="image/x-icon">
  <link rel="canonical" href="https://livrariaprometeu.com/ebooks">
  <link rel="stylesheet" href="https://livrariaprometeu.com/01_SITE/css/header.css">

  <style>
    :root{
      --bg:#faf9f7; --paper:#fff; --ink:#222; --muted:#6b6b6b;
      --accent:#2b6b58; --accent-2:#673e32; --radius:12px;
      --shadow:0 10px 30px rgba(15,15,15,0.06); --card-shadow:0 8px 26px rgba(15,15,15,0.05);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:28px}

    /* Header (kept external) */
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 0}

    /* HERO */
    .hero{
      display:grid;
      grid-template-columns:1fr 360px;
      gap:28px;
      align-items:center;
      margin:32px 0;
      background:linear-gradient(135deg,#fdfdfd 0%,#f6f5f3 100%);
      padding:28px;
      border-radius:14px;
      box-shadow:var(--shadow);
    }
    .hero h1{font-size:2.2rem;margin:0 0 8px}
    .hero p{margin:0;color:var(--muted)}
    .ctas{display:flex;gap:12px;align-items:center}
    .btn{padding:10px 14px;border-radius:12px;border:0;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;border:2px solid var(--accent);color:var(--accent)}
    .micro{color:var(--muted);font-size:0.95rem}

    /* Mobile: empilha CTAs */
    @media(max-width:820px){
      .hero{grid-template-columns:1fr; text-align:center; padding:24px}
      .hero .ctas{flex-direction:column}
      .btn{width:100%;max-width:320px}
    }

    /* toolbar */
    .toolbar{display:flex;gap:12px;align-items:center;margin:18px 0;flex-wrap:wrap}
    .search{flex:1;display:flex;background:var(--paper);padding:8px;border-radius:12px;box-shadow:var(--card-shadow);align-items:center}
    .search input{border:0;outline:0;font-size:1rem;background:transparent;padding:6px 8px;flex:1}
    .btn-small{padding:8px 10px;border-radius:10px;border:1px solid #eee;background:transparent;cursor:pointer}
    .chip{background:#fff;padding:8px 10px;border-radius:999px;border:1px solid #eee;cursor:pointer}
    .filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    /* curation */
    .curation{display:flex;gap:12px;overflow:auto;padding:12px 4px;margin-top:8px}
    .card-small{flex:0 0 220px;background:var(--paper);padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center;box-shadow:var(--card-shadow)}
    .card-small img{width:48px;height:68px;object-fit:cover;border-radius:4px}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:6px}
    .card{background:var(--paper);padding:12px;border-radius:12px;box-shadow:var(--card-shadow);display:flex;flex-direction:column;gap:10px;min-height:300px;transition:transform .18s ease;cursor:default}
    .card:hover{transform:translateY(-6px)}
    .img-wrap{height:170px;display:flex;align-items:center;justify-content:center;overflow:hidden;border-radius:8px}
    .img-wrap img{max-height:100%;max-width:100%;object-fit:contain;display:block;transition:transform .28s}
    .card:hover .img-wrap img{transform:scale(1.03)}
    .title{font-weight:700}
    .author{color:var(--muted);font-size:0.95rem}
    .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:0.9rem}
    .actions{display:flex;gap:8px;margin-top:auto;align-items:center}

    @media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){.grid{grid-template-columns:1fr}.curation{display:none}}

    /* tooltip excerpt */
    .tooltip{position:relative}
    .tooltip .tip{position:absolute;left:8px;top:8px;background:rgba(0,0,0,0.85);color:white;padding:8px 10px;border-radius:8px;font-size:0.87rem;display:none;z-index:20;max-width:280px}
    .tooltip:hover .tip{display:block}

    /* toast */
    .toast{position:fixed;right:20px;bottom:20px;background:var(--accent-2);color:white;padding:10px 12px;border-radius:10px;display:none;z-index:90}

    /* =========================
       Modal CinemÃ¡tico (completo)
       ========================= */
    .modal {
      position: fixed; inset:0;
      display: none;
      justify-content: center; align-items: center;
      background: rgba(0,0,0,0.65);
      z-index: 100;
      padding: 20px;
    }
    .modal.open { display: flex; }

    .modal-card {
      display: flex;
      flex-direction: column;
      max-width: 720px;
      width: 100%;
      background: #fff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
      transform: translateY(-20px);
      opacity: 0;
      animation: modalIn 0.45s forwards cubic-bezier(0.2,0,0.2,1);
    }

    #modalCover img {
      width: 100%;
      max-height: 380px;
      object-fit: cover;
      transform: translateY(-24px);
      opacity: 0;
      animation: coverIn 0.5s forwards 0.12s;
    }

    .modal-content {
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .close-btn {
      position: absolute;
      right: 12px;
      top: 10px;
      background: transparent;
      border: none;
      font-size: 1.6rem;
      cursor: pointer;
      color: var(--muted);
    }

    .modal-content h3 {
      font-size: 1.6rem;
      font-weight: 700;
      margin: 0;
      line-height: 1.15;
    }

    .modal-micro{color:var(--muted);font-size:0.95rem}

    .tags { display:flex;gap:8px;flex-wrap:wrap;margin-top:6px }
    .tags .chip { background:#eaf7f3;color:#0b6b53;padding:6px 8px;border-radius:999px;font-size:0.85rem }

    .modal-excerpt {
      max-height: 220px;
      overflow-y: auto;
      padding:10px;
      background:#fbfbfb;border-radius:8px;font-style:italic;color:#111;
    }

    .modal-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}

    @keyframes modalIn { to { transform: translateY(0); opacity:1; } }
    @keyframes coverIn { to { transform: translateY(0); opacity:1; } }

    @media(max-width:600px){
      .modal-card { max-width: 96%; }
      #modalCover img { max-height: 260px; }
      .modal-content h3 { font-size:1.3rem }
    }

  </style>
</head>
<body>
  <script src="https://livrariaprometeu.com/01_SITE/js/header.js"></script>
  <script> if(window.loadHeader) loadHeader(); </script>

  <main class="container" id="app">
    <!-- HERO -->
    <section class="hero" aria-label="Explorar e-books gratuitos">
      <div>
        <h1>Que livro vai acender sua prÃ³xima ideia?</h1>
        <p class="micro">Curadoria humana â€” clÃ¡ssicos e descobertas, formatados para leitura confortÃ¡vel. Sem cadastro.</p>

        <div class="ctas" style="margin-top:12px">
          <button class="btn btn-primary" id="exploreBtn">Explorar obras que mudaram o mundo</button>
          <button class="btn btn-ghost" id="surpriseBtn">Surpreenda-me ðŸ”€</button>
          <span class="micro" style="align-self:center;margin-left:8px">JÃ¡ sÃ£o <strong id="totalCount">â€”</strong> tÃ­tulos</span>
        </div>

        <p style="margin-top:12px" class="micro">Curadoria humana â€¢ Tipografia otimizada â€¢ Download fÃ¡cil â€¢ Compartilhe ideias</p>

        <div class="toolbar" style="margin-top:14px">
          <div class="search" role="search" aria-label="Pesquisar e-books">
            <input id="q" type="search" placeholder="Buscar por tÃ­tulo, autor, assunto..." aria-label="Buscar e-books">
            <button id="clearSearch" title="Limpar" class="btn-small" aria-label="Limpar busca">âœ•</button>
          </div>

          <div class="filters" aria-hidden="false">
            <div class="chip" data-filter="all">Todos</div>
            <div class="chip" data-filter="pensar">Para pensar</div>
            <div class="chip" data-filter="acalmar">Para acalmar</div>
            <div class="chip" data-filter="ensino">Ensino & ReferÃªncia</div>
            <div class="chip" data-filter="poesia">Poesia</div>
          </div>
        </div>
      </div>

      <aside class="hero-aside" aria-hidden="true">
        <div style="display:flex;gap:12px;align-items:center">
          <img src="https://livrariaprometeu.com/01_SITE/assets/img/hero-ebooks.webp" alt="" style="width:78px;height:110px;object-fit:cover;border-radius:8px" loading="lazy">
          <div>
            <div class="stat" id="featuredTitle">Descubra algo novo</div>
            <div class="micro" style="margin-top:6px">Clique em <strong>Surpreenda-me</strong> para ver um destaque e ler um trecho.</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="micro"><strong>Favoritos</strong></div>
          <div id="favList" style="margin-top:8px;color:var(--muted)">Nenhum ainda â€” salve capas que gostar.</div>
        </div>
      </aside>
    </section>

    <!-- Curadoria -->
    <section aria-label="Curadoria Prometeu">
      <h2 style="margin:8px 0">Curadorias rÃ¡pidas</h2>
      <div class="curation" id="curationStrip" aria-hidden="false"></div>
    </section>

    <!-- Grid de ebooks -->
    <section id="ebooks">
      <div id="ebookGrid" class="grid" aria-live="polite"></div>
      <div style="text-align:center;margin-top:18px">
        <button id="loadMore" class="btn btn-ghost" style="display:none">Carregar mais</button>
      </div>
    </section>

    <p style="margin-top:28px" class="micro">Baixe, leia, compartilhe â€” o conhecimento pertence a quem o cultiva.</p>

    <!-- RecomendaÃ§Ãµes de artigos -->
    <section style="margin-top:64px;padding-top:32px;border-top:1px solid #eee">
      <h2 style="margin-bottom:16px">Leituras recomendadas</h2>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px">
        <article style="background:var(--paper);padding:16px;border-radius:12px;box-shadow:var(--card-shadow)">
          <img src="https://livrariaprometeu.com/01_SITE/assets/img/artigos/o-mito-de-prometeu.webp" alt="O mito de Prometeu" style="width:100%;height:150px;object-fit:cover;border-radius:8px">
          <h3 style="margin:12px 0 6px;font-size:1.1rem">O mito de Prometeu e o poder da leitura</h3>
          <p class="micro">A faÃ­sca da curiosidade que transformou o fogo em conhecimento humano.</p>
          <a href="https://livrariaprometeu.com/artigos/o-mito-de-prometeu" class="btn btn-ghost" style="margin-top:10px">Ler artigo</a>
        </article>

        <article style="background:var(--paper);padding:16px;border-radius:12px;box-shadow:var(--card-shadow)">
          <img src="https://livrariaprometeu.com/01_SITE/assets/img/artigos/leitura-fogo-da-consciencia.webp" alt="Leitura: o primeiro fogo da consciÃªncia humana" style="width:100%;height:150px;object-fit:cover;border-radius:8px">
          <h3 style="margin:12px 0 6px;font-size:1.1rem">Leitura: o primeiro fogo da consciÃªncia humana</h3>
          <p class="micro">Por que ler Ã© um ato de criar o mundo, nÃ£o apenas compreendÃª-lo.</p>
          <a href="https://livrariaprometeu.com/artigos/leitura-primeiro-fogo" class="btn btn-ghost" style="margin-top:10px">Ler artigo</a>
        </article>

        <article style="background:var(--paper);padding:16px;border-radius:12px;box-shadow:var(--card-shadow)">
          <img src="https://livrariaprometeu.com/01_SITE/assets/img/artigos/como-escolher-livro.webp" alt="Como escolher o prÃ³ximo livro que vai mudar sua vida" style="width:100%;height:150px;object-fit:cover;border-radius:8px">
          <h3 style="margin:12px 0 6px;font-size:1.1rem">Como escolher o prÃ³ximo livro que vai mudar sua vida</h3>
          <p class="micro">Uma curadoria prometeica para encontrar livros que acendem ideias.</p>
          <a href="https://livrariaprometeu.com/artigos/como-escolher-o-proximo-livro" class="btn btn-ghost" style="margin-top:10px">Ler artigo</a>
        </article>
      </div>
    </section>
  </main>

  <!-- Modal CinemÃ¡tico -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitleDesc">
      <button class="close-btn" id="closeModal" aria-label="Fechar">âœ•</button>
      <div id="modalCover"></div>

      <div class="modal-content">
        <h3 id="modalTitle"></h3>
        <div id="modalAuthor" class="modal-micro"></div>
        <div id="modalTags" class="tags" aria-hidden="true"></div>
        <div id="modalMeta" class="modal-micro"></div>
        <div id="modalExcerpt" class="modal-excerpt"></div>

        <div class="modal-actions">
          <a id="modalDownload" class="btn btn-primary" target="_blank" rel="noopener">Ler / Baixar</a>
          <button id="modalSave" class="btn btn-ghost">Salvar</button>
          <button id="shareBtn" class="btn btn-ghost">Compartilhar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">AÃ§Ã£o realizada</div>

  <script>
    // CONFIG
    const JSON_URL = 'https://livrariaprometeu.com/livros/ebooks.json'; // ajuste se preciso
    let ebooks = [];
    let shown = 0;
    const PAGE_SIZE = 9;
    let activeFilter = 'all';
    const favoritesKey = 'prometeu_favs_v1';

    // HELPERS DOM
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = msg => {
      const t = $('#toast');
      t.textContent = msg;
      t.style.display = 'block';
      setTimeout(()=> t.style.display='none', 1600);
    };

    // FETCH JSON
    fetch(JSON_URL)
      .then(r => r.json())
      .then(data => {
        ebooks = Array.isArray(data) ? data : (data.items || []);
        $('#totalCount').textContent = ebooks.length;
        buildCurationStrip();
        renderInitial();
        restoreFavoritesUI();
      })
      .catch(err => {
        console.error('erro ao carregar ebooks', err);
        $('#ebookGrid').innerHTML = '<p style="color:var(--muted)">Erro ao carregar a coleÃ§Ã£o.</p>';
      });

    // CURATION STRIP
    function buildCurationStrip(){
      const strip = $('#curationStrip');
      if(!strip) return;
      strip.innerHTML = '';
      const picks = ebooks.slice(0, 12);
      picks.forEach(e => {
        const node = document.createElement('div');
        node.className = 'card-small';
        node.innerHTML = `<img src="${e.capa}" alt="${escapeHtml(e.titulo)}" loading="lazy"><div><strong style="display:block">${e.titulo}</strong><span class="micro">${e.autor||''}</span></div>`;
        node.onclick = () => openModal(e);
        strip.appendChild(node);
      });
    }

    // RENDER / PAGINAÃ‡ÃƒO
    function renderInitial(){
      shown = 0;
      $('#ebookGrid').innerHTML = '';
      renderMore();
    }

    function renderMore(){
      const grid = $('#ebookGrid');
      const filtered = applyFilterSearch();
      const slice = filtered.slice(shown, shown + PAGE_SIZE);
      slice.forEach(e => grid.appendChild(bookCard(e)));
      shown += slice.length;
      $('#loadMore').style.display = (shown < filtered.length) ? 'inline-block' : 'none';
    }

    $('#loadMore').addEventListener('click', renderMore);

    // CRIA CARD
    function bookCard(e){
      const card = document.createElement('article');
      card.className = 'card tooltip';
      const excerpt = e.excerpt ? e.excerpt.slice(0,220) + (e.excerpt.length>220?'â€¦':'') : 'â€”';

      card.innerHTML = `
        <div class="img-wrap"><img src="${e.capa}" alt="Capa ${escapeHtml(e.titulo)}" loading="lazy"></div>
        <div class="title">${e.titulo}</div>
        <div class="author">${e.autor || ''}</div>
        <div class="meta">
          <div style="color:var(--muted);font-size:0.95rem">${e.idioma || '-'}</div>
          <div style="font-size:0.9rem;color:var(--muted)">${e.tamanho || '-'}</div>
        </div>
        <div class="actions">
          <button class="btn-small btn-open" data-id="${e.id}" aria-label="Abrir ${e.titulo}">Abrir</button>
          ${e.arquivo.url ? `<a class="btn-small" href="${e.arquivo.url}" target="_blank" rel="noopener">Ler</a>` : ''}
          <button class="btn-small save-btn" data-id="${e.id}" aria-label="Salvar ${e.titulo}">â™¥</button>
        </div>
        <div class="tip">${escapeHtml(excerpt)}</div>
      `;

      // abrir modal ao clicar no card (ou no botÃ£o Abrir)
      card.querySelector('.btn-open').addEventListener('click', (ev) => { ev.stopPropagation(); openModal(e); });
      card.addEventListener('click', () => openModal(e));

      // salvar favorito (botÃ£o)
      card.querySelector('.save-btn').addEventListener('click', (ev) => {
        ev.stopPropagation();
        toggleFavorite(e);
      });

      return card;
    }

    // OPEN MODAL (cinemÃ¡tico)
    function openModal(e){
      const modal = $('#modal');
      // capa
      $('#modalCover').innerHTML = `<img src="${e.capa}" alt="${escapeHtml(e.titulo)}">`;
      // textos
      $('#modalTitle').textContent = e.titulo;
      $('#modalAuthor').textContent = e.autor || '';
      $('#modalMeta').textContent = `${e.categoria || '-'} â€¢ ${e.idioma || '-'} â€¢ ${e.tamanho || '-'}`;
      // tags
      const tagContainer = $('#modalTags');
      tagContainer.innerHTML = (e.tags && e.tags.length) ? e.tags.map(t => `<span class="chip">${t}</span>`).join('') : '';
      // excerpt
      $('#modalExcerpt').innerHTML = e.descricao ? `<em>${escapeHtml(e.descricao)}</em>` : '<div class="micro">Sem trecho disponÃ­vel</div>';
      // download
      const downloadBtn = $('#modalDownload');

      if (e.arquivo && e.arquivo.downloadDisponivel && e.arquivo.url) {
        downloadBtn.href = e.arquivo.url;
        downloadBtn.textContent = 'Ler';
      } else if (e.linkAmazon) {
        downloadBtn.href = e.linkAmazon;
        downloadBtn.textContent = 'Comprar na Amazon';
      } else {
        downloadBtn.href = '#';
        downloadBtn.textContent = 'IndisponÃ­vel';
      }

      // salvar
      $('#modalSave').onclick = () => { toggleFavorite(e); updateModalSaveState(e); };
      updateModalSaveState(e);

      // compartilhar
      $('#shareBtn').onclick = () => {
        const url = e.fileDownload || e.linkamz || window.location.href;
        if(navigator.share){
          navigator.share({titulo: e.titulo, text: e.excerpt || '', url});
        } else {
          copyToClipboard(url);
          toast('Link copiado para a Ã¡rea de transferÃªncia');
        }
      };

      // exibir modal
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      // update featured title in aside
      $('#featuredTitle').textContent = e.titulo;
    }

    // fechar modal
    $('#closeModal').addEventListener('click', closeModal);
    $('#modal').addEventListener('click', (ev) => { if (ev.target.id === 'modal') closeModal(); });
    function closeModal(){
      const modal = $('#modal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    // BUSCA E FILTROS
    $('#q').addEventListener('input', () => { shown = 0; $('#ebookGrid').innerHTML=''; renderMore(); });
    $('#clearSearch').addEventListener('click', () => { $('#q').value=''; shown=0; $('#ebookGrid').innerHTML=''; renderMore(); });

    $$('.chip').forEach(ch => ch.addEventListener('click', ev => {
      $$('.chip').forEach(c => c.style.borderColor='#eee');
      ev.currentTarget.style.borderColor = 'var(--accent)';
      activeFilter = ev.currentTarget.dataset.filter;
      shown = 0; $('#ebookGrid').innerHTML=''; renderMore();
    }));

    function applyFilterSearch(){
      const q = $('#q').value.trim().toLowerCase();
      let list = ebooks.slice();

      if (activeFilter && activeFilter !== 'all'){
        list = list.filter(e =>
          (e.tags && e.tags.includes(activeFilter)) ||
          (e.categoria && e.categoria.toLowerCase().includes(activeFilter))
        );
      }

      if (q){
        list = list.filter(e =>
        (e.titulo && e.titulo.toLowerCase().includes(q)) ||
        (e.autor && e.autor.toLowerCase().includes(q)) ||
        (e.categoria && e.categoria.toLowerCase().includes(q)) ||
        (e.excerpt && e.excerpt.toLowerCase().includes(q))
      );
      }

      // destaque first if exists
      list.sort((a,b) => (b.destaque?1:0) - (a.destaque?1:0));
      return list;
    }

    // SURPREENDA-ME
    $('#surpriseBtn').addEventListener('click', () => {
      if (!ebooks.length) return;
      const idx = Math.floor(Math.random() * ebooks.length);
      const e = ebooks[idx];
      window.scrollTo({top: $('#ebooks').offsetTop - 80, behavior:'smooth'});
      setTimeout(()=> openModal(e), 500);
    });

    // EXPLORE
    $('#exploreBtn').addEventListener('click', () => {
      window.scrollTo({top: $('#ebooks').offsetTop - 30, behavior:'smooth'});
    });

    // FAVORITOS (localStorage)
    function getFavs(){ try { return JSON.parse(localStorage.getItem(favoritesKey) || '[]'); } catch { return []; } }
    function saveFavs(arr){ localStorage.setItem(favoritesKey, JSON.stringify(arr)); }

    function toggleFavorite(e){
      const favs = getFavs();
      const existsIdx = favs.findIndex(a => a.id === e.id);
      if (existsIdx > -1){
        favs.splice(existsIdx,1);
        saveFavs(favs);
        toast('Removido dos favoritos');
      } else {
        favs.unshift({id: e.id, title: e.title, cover: e.cover});
        saveFavs(favs);
        toast('Adicionado aos favoritos');
      }
      restoreFavoritesUI();
      updateSaveButtons();
    }

    function restoreFavoritesUI(){
      const wrap = $('#favList');
      const favs = getFavs();
      if (!favs.length){ wrap.textContent = 'Nenhum ainda â€” salve capas que gostar.'; return; }
      wrap.innerHTML = favs.slice(0,6).map(f => `<div style="display:inline-block;margin-right:8px"><img src="${f.cover}" alt="${escapeHtml(f.title)}" style="width:34px;height:50px;object-fit:cover;border-radius:4px"></div>`).join('');
    }

    function updateModalSaveState(e){
      const favs = getFavs();
      const exists = favs.find(a => a.id === e.id);
      $('#modalSave').textContent = exists ? 'Remover' : 'Salvar';
    }

    function updateSaveButtons(){
      $$('.save-btn').forEach(btn => {
        const id = Number(btn.dataset.id);
        const exists = getFavs().some(f => f.id === id);
        btn.textContent = exists ? 'âœ“' : 'â™¥';
      });
    }

    // Helpers
    function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function copyToClipboard(text){ navigator.clipboard?.writeText(text).catch(()=>{}); }

    // Render all immediate (utility)
    function renderAllCardsImmediately(){
      const grid = $('#ebookGrid');
      grid.innerHTML = '';
      ebooks.forEach(e => grid.appendChild(bookCard(e)));
    }

    // Observe grid changes to update save buttons
    const observer = new MutationObserver(() => setTimeout(updateSaveButtons, 300));
    observer.observe(document.getElementById('ebookGrid'), { childList: true, subtree: true });

    // Keyboard accessibility: Esc fecha modal
    document.addEventListener('keydown', (ev) => { if(ev.key === 'Escape') closeModal(); });

  </script>
</body>
</html>








