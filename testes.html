<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Livraria Prometeu â€” Descubra E-books Gratuitos</title>
  <meta name="description" content="ColeÃ§Ã£o gratuita da Prometeu. ClÃ¡ssicos e descobertas para ler agora." />
  <meta name="keywords" content="ebooks gratuitos, clÃ¡ssicos, leitura, Livraria Prometeu" />
  <link rel="icon" href="https://livrariaprometeu.com/03_MIDIA/logos/livraria_prometeu_original.webp" type="image/x-icon">
  <link rel="canonical" href="https://livrariaprometeu.com/ebooks">
  <link rel="stylesheet" href="https://livrariaprometeu.com/01_SITE/css/header.css">

  <!-- Estilos enxutos - adapte cores ao seu design -->
  <style>
    :root{
      --bg:#faf9f7; --paper:#fff; --ink:#222; --muted:#6b6b6b;
      --accent:#2b6b58; --accent-2:#673e32; --radius:12px;
      --shadow:0 10px 30px rgba(15,15,15,0.06); --card-shadow:0 8px 26px rgba(15,15,15,0.05);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased}
    .container{max-width:1100px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .logo{font-weight:700;letter-spacing:0.06em}
    /* HERO */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center;margin:8px 0 18px}
    .hero h1{font-size:2.2rem;margin:0 0 8px}
    .hero p{margin:0;color:var(--muted)}
    .hero .ctas{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
    .btn{padding:11px 16px;border-radius:12px;border:0;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;border:2px solid var(--accent);color:var(--accent)}
    .hero-aside{background:var(--paper);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    .stat{font-weight:700;font-size:1.3rem}
    /* Search + filters */
    .toolbar{display:flex;gap:12px;align-items:center;margin:18px 0;flex-wrap:wrap}
    .search{flex:1;display:flex;background:var(--paper);padding:8px;border-radius:12px;box-shadow:var(--card-shadow)}
    .search input{border:0;outline:0;font-size:1rem;background:transparent;padding:6px 8px;flex:1}
    .chip{background:#fff;padding:8px 10px;border-radius:999px;border:1px solid #eee;cursor:pointer}
    .filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:6px}
    .card{background:var(--paper);padding:12px;border-radius:12px;box-shadow:var(--card-shadow);display:flex;flex-direction:column;gap:8px;min-height:300px;transition:transform .18s ease}
    .card:hover{transform:translateY(-6px)}
    .img-wrap{height:170px;display:flex;align-items:center;justify-content:center;overflow:hidden;border-radius:8px}
    .img-wrap img{max-height:100%;max-width:100%;object-fit:contain;display:block;transition:transform .28s}
    .card:hover .img-wrap img{transform:scale(1.03)}
    .title{font-weight:700}
    .author{color:var(--muted);font-size:0.95rem}
    .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:0.9rem}
    .actions{display:flex;gap:8px;margin-top:auto;align-items:center}
    .btn-small{padding:8px 10px;border-radius:10px;border:1px solid #eee;background:transparent;cursor:pointer}
    /* Curation strip */
    .curation{display:flex;gap:12px;overflow:auto;padding:12px 4px;margin-top:18px}
    .card-small{flex:0 0 220px;background:var(--paper);padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center;box-shadow:var(--card-shadow)}
    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(10,10,10,0.5);display:none;align-items:center;justify-content:center;padding:20px;z-index:60}
    .modal.open{display:flex}
    .modal-card{background:white;max-width:900px;width:100%;border-radius:12px;padding:18px;display:grid;grid-template-columns:240px 1fr;gap:16px}
    /* Tooltip (excerpt hover) */
    .tooltip{position:relative}
    .tooltip .tip{position:absolute;left:8px;top:8px;background:rgba(0,0,0,0.85);color:white;padding:8px 10px;border-radius:8px;font-size:0.87rem;display:none;z-index:20;max-width:280px}
    .tooltip:hover .tip{display:block}
    /* Responsive */
    @media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}.hero{grid-template-columns:1fr;}.hero-aside{order:2}}
    @media(max-width:600px){.grid{grid-template-columns:1fr}.curation{display:none}}
    /* microcopy & toast */
    .micro{color:var(--muted);font-size:0.95rem}
    .toast{position:fixed;right:20px;bottom:20px;background:var(--accent-2);color:white;padding:10px 12px;border-radius:10px;display:none}
  </style>
</head>
<body>
  <script src="https://livrariaprometeu.com/01_SITE/js/header.js"></script>
  <script>if(window.loadHeader) loadHeader();</script>

  <main class="container" id="app">
    <section class="hero" aria-label="Explorar e-books gratuitos">
      <div>
        <h1>Que livro vai acender sua prÃ³xima ideia?</h1>
        <p class="micro">Uma coleÃ§Ã£o selecionada de clÃ¡ssicos e descobertas â€” formatados para leitura confortÃ¡vel. Sem cadastro, sem barreiras.</p>

        <div class="ctas">
          <button class="btn btn-primary" id="exploreBtn">Explorar obras que mudaram o mundo</button>
          <button class="btn btn-ghost" id="surpriseBtn">Surpreenda-me ðŸ”€</button>
          <span class="micro" style="align-self:center;margin-left:6px">JÃ¡ sÃ£o <strong id="totalCount">â€”</strong> tÃ­tulos</span>
        </div>

        <p style="margin-top:14px;color:var(--muted)">Curadoria humana â€¢ Tipografia otimizada â€¢ Download fÃ¡cil â€¢ Compartilhe ideias</p>

        <div class="toolbar" style="margin-top:16px">
          <div class="search" role="search" aria-label="Pesquisar e-books">
            <input id="q" type="search" placeholder="Buscar por tÃ­tulo, autor, assunto..." aria-label="Buscar e-books">
            <button id="clearSearch" title="Limpar" class="btn-small" aria-label="Limpar busca">âœ•</button>
          </div>

          <div class="filters" aria-hidden="false">
            <div class="chip" data-filter="all">Todos</div>
            <div class="chip" data-filter="pensar">Para pensar</div>
            <div class="chip" data-filter="acalmar">Para acalmar</div>
            <div class="chip" data-filter="ensino">Ensino & ReferÃªncia</div>
            <div class="chip" data-filter="poesia">Poesia</div>
          </div>
        </div>
      </div>

      <aside class="hero-aside" aria-hidden="true">
        <div style="display:flex;gap:12px;align-items:center">
          <img src="https://livrariaprometeu.com/01_SITE/assets/img/hero-ebooks.webp" alt="" style="width:78px;height:110px;object-fit:cover;border-radius:8px" loading="lazy">
          <div>
            <div class="stat" id="featuredTitle">Descubra algo novo</div>
            <div class="micro" style="margin-top:6px">Clique em <strong>Surpreenda-me</strong> para ver um destaque e ler um trecho.</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="micro"><strong>Favoritos</strong></div>
          <div id="favList" style="margin-top:8px;color:var(--muted)">Nenhum ainda â€” salve capas que gostar.</div>
        </div>
      </aside>
    </section>

    <section aria-label="Curadoria Prometeu">
      <h2 style="margin:8px 0">Curadorias rÃ¡pidas</h2>
      <div class="curation" id="curationStrip" aria-hidden="false"></div>
    </section>

    <section id="ebooks">
      <div id="ebookGrid" class="grid" aria-live="polite"></div>
      <div style="text-align:center;margin-top:18px">
        <button id="loadMore" class="btn btn-ghost" style="display:none">Carregar mais</button>
      </div>
    </section>

    <p style="margin-top:28px" class="micro">Baixe, leia, compartilhe â€” o conhecimento pertence a quem o cultiva.</p>
  </main>

  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true" style="display: flex;flex-direction: column">
    <div class="modal-card" role="document">
      <div id="modalCover" style="display:flex;align-items:center;justify-content:center"></div>
      <div>
        <button id="closeModal" style="float:right" aria-label="Fechar">âœ•</button>
        <div style="display:flex;flex-direction:column">
          <h3 id="modalTitle"></h3>
          <div id="modalAuthor" class="micro"></div>
          <div style="margin-top:8px" id="modalMeta" class="micro"></div>
          <hr>
          <div id="modalExcerpt" style="max-height:260px;overflow:auto;color:#111"></div>
          <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
            <a id="modalDownload" class="btn btn-primary" href="#" target="_blank" rel="noopener">Ler / Baixar</a>
            <button id="modalSave" class="btn btn-ghost">Salvar</button>
            <div id="shareWrap" style="margin-left:auto">
              <button id="shareBtn" class="btn-small" title="Compartilhar">Compartilhar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="toast" id="toast">AÃ§Ã£o realizada</div>

  <script>
    const JSON_URL = 'https://livrariaprometeu.com/livros/ebooks.json';
    let ebooks = [];
    let shown = 0;
    const PAGE_SIZE = 9;
    let activeFilter = 'all';
    const favoritesKey = 'prometeu_favs_v1';

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = msg => {
      const t = document.getElementById('toast');
      t.textContent = msg; t.style.display = 'block';
      setTimeout(()=> t.style.display='none', 1600);
    };

    fetch(JSON_URL)
      .then(r => r.json())
      .then(data => {
        ebooks = data;
        document.getElementById('totalCount').textContent = ebooks.length;
        buildCurationStrip();
        renderInitial();
        restoreFavoritesUI();
      })
      .catch(err => {
        console.error('erro ao carregar ebooks', err);
        document.getElementById('ebookGrid').innerHTML = '<p style="color:var(--muted)">Erro ao carregar a coleÃ§Ã£o.</p>';
      });

    function buildCurationStrip(){
      const strip = document.getElementById('curationStrip');
      strip.innerHTML = '';
      const picks = ebooks.slice(0, 12);
      picks.forEach(e => {
        const node = document.createElement('div');
        node.className = 'card-small';
        node.innerHTML = `<img src="${e.cover}" alt="${escapeHtml(e.title)}" style="width:48px;height:68px;object-fit:cover;border-radius:4px" loading="lazy">
                          <div><strong style="display:block">${e.title}</strong><span class="micro">${e.author}</span></div>`;
        node.onclick = () => openModal(e);
        strip.appendChild(node);
      });
    }

    function renderInitial(){
      shown = 0;
      document.getElementById('ebookGrid').innerHTML = '';
      renderMore();
    }

    function renderMore(){
      const grid = document.getElementById('ebookGrid');
      const filtered = applyFilterSearch();
      const slice = filtered.slice(shown, shown + PAGE_SIZE);

      slice.forEach(e => grid.appendChild(bookCard(e)));
      shown += slice.length;

      const loadMoreBtn = document.getElementById('loadMore');
      if (shown < filtered.length){
        loadMoreBtn.style.display = 'inline-block';
      } else {
        loadMoreBtn.style.display = 'none';
      }
    }

    document.getElementById('loadMore').addEventListener('click', renderMore);

    function bookCard(e){
      const card = document.createElement('article');
      card.className = 'card tooltip';
      const excerpt = e.excerpt ? e.excerpt.slice(0,220) + (e.excerpt.length>220?'â€¦':'') : 'â€”';

      card.innerHTML = `
        <div class="img-wrap">
          <img src="${e.cover}" alt="Capa ${escapeHtml(e.title)}" loading="lazy">
        </div>
        <div class="title">${e.title}</div>
        <div class="author">${e.author}</div>
        <div class="meta">
          <div>Idioma: ${e.idioma || '-'}</div>
          <div>Tamanho: ${e.tamanho || '-'}</div>
        </div>
        <div class="actions">
          <button class="btn-small" data-id="${e.id}" aria-label="Abrir ${e.title}">Abrir</button>
          ${e.fileDownload ? `<a class="btn-small" href="${e.fileDownload}" target="_blank" rel="noopener">Ler</a>` : ''}
          <button class="btn-small save-btn" data-id="${e.id}" aria-label="Salvar ${e.title}">â™¥</button>
        </div>
        <div class="tip">${escapeHtml(excerpt)}</div>
      `;

      card.querySelector('[data-id]').addEventListener('click', () => openModal(e));
      card.querySelector('.save-btn').addEventListener('click', (ev) => {
        ev.stopPropagation();
        toggleFavorite(e);
      });
      return card;
    }

    function openModal(e){
      const modal = document.getElementById('modal');
      document.getElementById('modalTitle').textContent = e.title;
      document.getElementById('modalAuthor').textContent = e.author;
      document.getElementById('modalMeta').textContent = `${e.categoria || '-'} â€¢ ${e.idioma || '-'} â€¢ ${e.tamanho || '-'}`;
      document.getElementById('modalExcerpt').innerHTML = e.excerpt ? `<em>${escapeHtml(e.excerpt)}</em>` : '<div class="micro">Sem trecho disponÃ­vel</div>';
      const coverWrap = document.getElementById('modalCover');
      coverWrap.innerHTML = `<img src="${e.cover}" alt="${escapeHtml(e.title)}" style="width:180px;border-radius:8px;object-fit:cover">`;
      const dl = document.getElementById('modalDownload');
      dl.href = e.fileDownload || e.linkamz || '#';
      dl.setAttribute('aria-label', 'Baixar ou abrir ' + e.title);

      const save = document.getElementById('modalSave');
      save.onclick = () => { toggleFavorite(e); updateModalSaveState(e); };
      updateModalSaveState(e);

      document.getElementById('shareBtn').onclick = () => {
        if (navigator.share) {
          navigator.share({title: e.title, text: e.excerpt || '', url: e.fileDownload || window.location.href});
        } else {
          copyToClipboard(e.fileDownload || window.location.href);
          toast('Link copiado para a Ã¡rea de transferÃªncia');
        }
      };

      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }

    document.getElementById('closeModal').addEventListener('click', closeModal);
    document.getElementById('modal').addEventListener('click', (ev) => { if(ev.target.id === 'modal') closeModal(); });

    function closeModal(){
      const modal = document.getElementById('modal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    document.getElementById('q').addEventListener('input', () => { shown = 0; document.getElementById('ebookGrid').innerHTML=''; renderMore(); });
    document.getElementById('clearSearch').addEventListener('click', () => { document.getElementById('q').value=''; shown=0; document.getElementById('ebookGrid').innerHTML=''; renderMore(); });

    $$('.chip').forEach(ch => ch.addEventListener('click', ev => {
      $$('.chip').forEach(c => c.style.borderColor='#eee'); ev.currentTarget.style.borderColor = 'var(--accent)';
      activeFilter = ev.currentTarget.dataset.filter;
      shown = 0; document.getElementById('ebookGrid').innerHTML=''; renderMore();
    }));

    function applyFilterSearch(){
      const q = document.getElementById('q').value.trim().toLowerCase();
      let list = ebooks.slice();

      if (activeFilter && activeFilter !== 'all'){
        list = list.filter(e => (e.tags && e.tags.includes(activeFilter)) || (e.categoria && e.categoria.toLowerCase().includes(activeFilter)));
      }

      if (q) {
        list = list.filter(e => (e.title && e.title.toLowerCase().includes(q)) ||
                                (e.author && e.author.toLowerCase().includes(q)) ||
                                (e.categoria && e.categoria.toLowerCase().includes(q)) ||
                                (e.excerpt && e.excerpt.toLowerCase().includes(q)));
      }

      list.sort((a,b) => (b.destaque?1:0) - (a.destaque?1:0));
      return list;
    }

    document.getElementById('surpriseBtn').addEventListener('click', () => {
      if (!ebooks.length) return;
      const idx = Math.floor(Math.random() * ebooks.length);
      const e = ebooks[idx];
      window.scrollTo({top: document.getElementById('ebooks').offsetTop - 80, behavior:'smooth'});
      setTimeout(()=> openModal(e), 600);
      document.getElementById('featuredTitle').textContent = e.title;
    });

    document.getElementById('exploreBtn').addEventListener('click', () => {
      window.scrollTo({top: document.getElementById('ebooks').offsetTop - 30, behavior:'smooth'});
    });

    function getFavs(){ try { return JSON.parse(localStorage.getItem(favoritesKey) || '[]'); } catch { return []; } }
    function saveFavs(arr){ localStorage.setItem(favoritesKey, JSON.stringify(arr)); }
    function toggleFavorite(e){
      const favs = getFavs();
      const exists = favs.find(a => a.id === e.id);
      if (exists) {
        const filtered = favs.filter(a => a.id !== e.id); saveFavs(filtered); toast('Removido dos favoritos');
      } else {
        favs.unshift({id: e.id, title: e.title, cover: e.cover}); saveFavs(favs); toast('Adicionado aos favoritos');
      }
      restoreFavoritesUI();
      updateSaveButtons();
    }
    function restoreFavoritesUI(){
      const wrap = document.getElementById('favList');
      const favs = getFavs();
      if (!favs.length){ wrap.textContent = 'Nenhum ainda â€” salve capas que gostar.'; return; }
      wrap.innerHTML = favs.slice(0,6).map(f => `<div style="display:inline-block;margin-right:8px"><img src="${f.cover}" alt="${escapeHtml(f.title)}" style="width:34px;height:50px;object-fit:cover;border-radius:4px"></div>`).join('');
    }
    function updateModalSaveState(e){
      const favs = getFavs(); const exists = favs.find(a=>a.id===e.id);
      document.getElementById('modalSave').textContent = exists ? 'Remover' : 'Salvar';
    }
    function updateSaveButtons(){
      $$('.save-btn').forEach(btn => {
        const id = Number(btn.dataset.id);
        const exists = getFavs().some(f => f.id === id);
        btn.textContent = exists ? 'âœ“' : 'â™¥';
      });
    }

    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function copyToClipboard(text){ navigator.clipboard?.writeText(text).catch(()=>{}); }

    function renderAllCardsImmediately(){
      const grid = document.getElementById('ebookGrid');
      grid.innerHTML = '';
      ebooks.forEach(e => grid.appendChild(bookCard(e)));
    }

    function updateSaveButtonsWhenReady(){
      setTimeout(updateSaveButtons, 400);
    }

    const observer = new MutationObserver(() => updateSaveButtonsWhenReady());
    observer.observe(document.getElementById('ebookGrid'), { childList: true, subtree: true });

    document.addEventListener('keydown', (ev) => { if(ev.key === 'Escape') closeModal(); });

    setInterval(() => updateSaveButtons(), 1200);
  </script>
</body>
</html>



