<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Livraria Prometeu â€” Descubra E-books Gratuitos</title>
  <meta name="description" content="ColeÃ§Ã£o gratuita da Prometeu. ClÃ¡ssicos e descobertas para ler agora." />
  <meta name="keywords" content="ebooks gratuitos, clÃ¡ssicos, leitura, Livraria Prometeu" />
  <link rel="icon" href="https://livrariaprometeu.com/03_MIDIA/logos/livraria_prometeu_original.webp" type="image/x-icon">
  <link rel="canonical" href="https://livrariaprometeu.com/ebooks">
  <link rel="stylesheet" href="https://livrariaprometeu.com/01_SITE/css/header.css">

  <style>
    :root{
      --bg:#faf9f7; --paper:#fff; --ink:#222; --muted:#6b6b6b;
      --accent:#2b6b58; --accent-2:#673e32; --radius:12px;
      --shadow:0 10px 30px rgba(15,15,15,0.06); --card-shadow:0 8px 26px rgba(15,15,15,0.05);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--ink); -webkit-font-smoothing:antialiased}

    /* ===== Modal CinemÃ¡tico ===== */
    .modal {
      position: fixed; inset:0;
      display: none;
      justify-content: center; align-items: center;
      background: rgba(0,0,0,0.65);
      z-index: 100;
      padding: 20px;
    }
    .modal.open { display: flex; }

    .modal-card {
      display: flex;
      flex-direction: column;
      max-width: 650px;
      width: 100%;
      background: #fff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 15px 50px rgba(0,0,0,0.3);
      transform: translateY(-40px);
      opacity: 0;
      animation: modalIn 0.5s forwards cubic-bezier(0.4,0,0.2,1);
    }

    #modalCover img {
      width: 100%;
      max-height: 350px;
      object-fit: cover;
      transform: translateY(-50px);
      opacity: 0;
      animation: coverIn 0.6s forwards 0.2s;
    }

    .modal-content {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      opacity: 0;
      transform: translateY(20px);
      animation: contentIn 0.5s forwards 0.5s;
    }

    .close-btn {
      align-self: flex-end;
      background: transparent;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .modal-content h3 {
      font-size: 1.9rem;
      font-weight: 700;
      margin: 0;
      opacity: 0;
      transform: translateY(20px);
      animation: titleIn 0.5s forwards 0.6s;
    }

    #modalAuthor {
      font-size: 1rem;
      color: #555;
      opacity: 0;
      transform: translateY(15px);
      animation: authorIn 0.5s forwards 0.7s;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0;
      opacity: 0;
      transform: translateY(15px);
      animation: tagsIn 0.5s forwards 0.8s;
    }
    .tags .chip {
      background: #e0f2f1;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #00796b;
    }

    .modal-excerpt {
      max-height: 180px;
      overflow-y: auto;
      padding: 8px;
      background: #f9f9f9;
      border-radius: 8px;
      font-style: italic;
      color: #111;
      opacity: 0;
      transform: translateY(15px);
      animation: excerptIn 0.5s forwards 0.9s;
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
      opacity: 0;
      transform: translateY(15px);
      animation: actionsIn 0.5s forwards 1s;
    }

    @keyframes modalIn { to { transform: translateY(0); opacity:1; } }
    @keyframes coverIn { to { transform: translateY(0); opacity:1; } }
    @keyframes contentIn { to { opacity:1; transform: translateY(0); } }
    @keyframes titleIn { to { opacity:1; transform: translateY(0); } }
    @keyframes authorIn { to { opacity:1; transform: translateY(0); } }
    @keyframes tagsIn { to { opacity:1; transform: translateY(0); } }
    @keyframes excerptIn { to { opacity:1; transform: translateY(0); } }
    @keyframes actionsIn { to { opacity:1; transform: translateY(0); } }

    @media(max-width:600px){
      .modal-card { max-width: 95%; }
      .modal-content h3 { font-size: 1.6rem; }
    }

    /* ===== Resto do CSS original ===== */
    /* Hero, Grid, Cards, etc. */
    .container{max-width:1100px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    /* ... aqui entra todo o CSS do seu layout original (hero, grid, cards, etc.) ... */
  </style>
</head>
<body>
  <script src="https://livrariaprometeu.com/01_SITE/js/header.js"></script>
  <script>if(window.loadHeader) loadHeader();</script>

  <main class="container" id="app">
    <!-- Hero + BotÃµes -->
    <section class="hero">
      <div>
        <h1>Que livro vai acender sua prÃ³xima ideia?</h1>
        <div class="ctas">
          <button class="btn btn-primary" id="exploreBtn">Explorar obras que mudaram o mundo</button>
          <button class="btn btn-ghost" id="surpriseBtn">Surpreenda-me ðŸ”€</button>
          <span class="micro">JÃ¡ sÃ£o <strong id="totalCount">â€”</strong> tÃ­tulos</span>
        </div>
      </div>
    </section>

    <!-- Grid principal -->
    <section id="ebooks">
      <div id="ebookGrid" class="grid" aria-live="polite"></div>
      <div style="text-align:center;margin-top:18px">
        <button id="loadMore" class="btn btn-ghost" style="display:none">Carregar mais</button>
      </div>
    </section>
  </main>

  <!-- Modal CinemÃ¡tico -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card">
      <div id="modalCover"></div>
      <div class="modal-content">
        <button id="closeModal" class="close-btn" aria-label="Fechar">âœ•</button>
        <h3 id="modalTitle"></h3>
        <div id="modalAuthor" class="micro"></div>
        <div id="modalTags" class="tags"></div>
        <div id="modalMeta" class="micro"></div>
        <hr>
        <div id="modalExcerpt" class="modal-excerpt"></div>
        <div class="modal-actions">
          <a id="modalDownload" class="btn btn-primary" href="#" target="_blank" rel="noopener">Ler / Baixar</a>
          <button id="modalSave" class="btn btn-ghost">Salvar</button>
          <button id="shareBtn" class="btn-small" title="Compartilhar">Compartilhar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">AÃ§Ã£o realizada</div>

  <script>
    const JSON_URL = 'https://livrariaprometeu.com/livros/ebooks.json';
    let ebooks = [];
    let shown = 0;
    const PAGE_SIZE = 9;
    let activeFilter = 'all';
    const favoritesKey = 'prometeu_favs_v1';

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = msg => {
      const t = document.getElementById('toast');
      t.textContent = msg; t.style.display = 'block';
      setTimeout(()=> t.style.display='none', 1600);
    };

    fetch(JSON_URL)
      .then(r => r.json())
      .then(data => {
        ebooks = data;
        document.getElementById('totalCount').textContent = ebooks.length;
        renderInitial();
        restoreFavoritesUI();
      })
      .catch(err => console.error('Erro ao carregar ebooks', err));

    function renderInitial(){ shown=0; document.getElementById('ebookGrid').innerHTML=''; renderMore(); }
    function renderMore(){
      const grid = document.getElementById('ebookGrid');
      const filtered = applyFilterSearch();
      const slice = filtered.slice(shown, shown + PAGE_SIZE);
      slice.forEach(e => grid.appendChild(bookCard(e)));
      shown += slice.length;
      document.getElementById('loadMore').style.display = (shown < filtered.length) ? 'inline-block' : 'none';
    }
    document.getElementById('loadMore').addEventListener('click', renderMore);

    function bookCard(e){
      const card = document.createElement('article');
      card.className = 'card tooltip';
      const excerpt = e.excerpt ? e.excerpt.slice(0,220)+(e.excerpt.length>220?'â€¦':''):'â€”';
      card.innerHTML = `
        <div class="card-cover" style="background-image:url(${e.cover})"></div>
        <div class="card-body">
          <h3>${e.title}</h3>
          <div class="micro">${e.author||''}</div>
        </div>`;
      card.onclick = ()=>openModal(e);
      return card;
    }

    /* ===== Modal CinemÃ¡tico JS ===== */
    function openModal(e){
      const modal = document.getElementById('modal');
      const coverWrap = document.getElementById('modalCover');
      coverWrap.innerHTML = `<img src="${e.cover}" alt="${escapeHtml(e.title)}">`;
      document.getElementById('modalTitle').textContent = e.title;
      document.getElementById('modalAuthor').textContent = e.author;
      const tagContainer = document.getElementById('modalTags');
      tagContainer.innerHTML = e.tags ? e.tags.map(t=>`<span class="chip">${t}</span>`).join('') : '';
      document.getElementById('modalMeta').textContent = `${e.categoria||'-'} â€¢ ${e.idioma||'-'} â€¢ ${e.tamanho||'-'}`;
      document.getElementById('modalExcerpt').innerHTML = e.excerpt ? `<em>${escapeHtml(e.excerpt)}</em>` : '<div class="micro">Sem trecho disponÃ­vel</div>';
      const dl = document.getElementById('modalDownload');
      dl.href = e.fileDownload || e.linkamz || '#';
      dl.setAttribute('aria-label','Baixar ou abrir ' + e.title);
      const save = document.getElementById('modalSave');
      save.onclick = ()=>{ toggleFavorite(e); updateModalSaveState(e); };
      updateModalSaveState(e);
      document.getElementById('shareBtn').onclick = ()=>{
        if(navigator.share){
          navigator.share({title:e.title,text:e.excerpt||'',url:e.fileDownload||window.location.href});
        } else {
          navigator.clipboard.writeText(e.fileDownload||window.location.href);
          toast('Link copiado para a Ã¡rea de transferÃªncia');
        }
      };
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }

    document.getElementById('closeModal').addEventListener('click',closeModal);
    document.getElementById('modal').addEventListener('click',ev=>{if(ev.target.id==='modal') closeModal();});
    function closeModal(){
      const modal = document.getElementById('modal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    /* ===== Favoritos ===== */
    function toggleFavorite(e){
      const favs = JSON.parse(localStorage.getItem(favoritesKey)||'[]');
      const index = favs.findIndex(f=>f.id===e.id);
      if(index>-1){ favs.splice(index,1); toast('Removido dos favoritos'); }
      else{ favs.push(e); toast('Adicionado aos favoritos'); }
      localStorage.setItem(favoritesKey,JSON.stringify(favs));
    }
    function updateModalSaveState(e){
      const favs = JSON.parse(localStorage.getItem(favoritesKey)||'[]');
      document.getElementById('modalSave').textContent = favs.some(f=>f.id===e.id)?'Salvo':'Salvar';
    }
    function restoreFavoritesUI(){ /* opcional: atualizar cards com estrela */ }

    /* ===== Surpreenda-me ===== */
    document.getElementById('surpriseBtn').addEventListener('click',()=>{
      if(!ebooks.length) return;
      const rand = ebooks[Math.floor(Math.random()*ebooks.length)];
      openModal(rand);
    });

    function applyFilterSearch(){ return ebooks; /* placeholder para futura filtragem */ }

  </script>
</body>
</html>
