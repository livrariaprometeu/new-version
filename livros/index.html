<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Livraria Prometeu â€” Descubra E-books Gratuitos</title>
  <meta name="description" content="ColeÃ§Ã£o gratuita da Prometeu. ClÃ¡ssicos e descobertas para ler agora." />
  <meta name="keywords" content="ebooks gratuitos, clÃ¡ssicos, leitura, Livraria Prometeu" />
  <link rel="icon" href="https://livrariaprometeu.com/03_MIDIA/logos/livraria_prometeu_original.webp" type="image/x-icon">
  <link rel="canonical" href="https://livrariaprometeu.com/ebooks">
  <link rel="stylesheet" href="https://livrariaprometeu.com/01_SITE/css/header.css">

  <link rel="stylesheet" href="https://livrariaprometeu.com/livros/style.css">
</head>
<body>
  <script src="https://livrariaprometeu.com/01_SITE/js/header.js"></script>
  <script> if(window.loadHeader) loadHeader(); </script>

  <main class="container" id="app">
    <!-- HERO -->
    <section class="hero" aria-label="Explorar e-books gratuitos">
      <div>
        <h1 style="color:var(--accent)">Que livro vai acender sua prÃ³xima ideia?</h1>
        <p class="micro">Curadoria humana â€” clÃ¡ssicos e descobertas, formatados para leitura confortÃ¡vel. Sem cadastro.</p>

        <div class="ctas" style="margin-top:12px">
          <button class="btn btn-primary" id="exploreBtn">Explorar obras que mudaram o mundo</button>
          <button class="btn btn-ghost" id="surpriseBtn">Surpreenda-me ðŸ”€</button>
          <span class="micro" style="align-self:center;margin-left:8px">JÃ¡ sÃ£o <strong id="totalCount">â€”</strong> tÃ­tulos</span>
        </div>

        <p style="margin-top:12px" class="micro">Curadoria humana â€¢ Tipografia otimizada â€¢ Download fÃ¡cil â€¢ Compartilhe ideias</p>

        <div class="toolbar" style="margin-top:14px">
          <div class="search" role="search" aria-label="Pesquisar e-books">
            <input id="q" type="search" placeholder="Buscar por tÃ­tulo, autor, assunto..." aria-label="Buscar e-books">
            <button id="clearSearch" title="Limpar" class="btn-small" aria-label="Limpar busca">âœ•</button>
          </div>

          <div class="filters" aria-hidden="false">
            <div class="chip" data-filter="all">Todos</div>
            <div class="chip" data-filter="pensar">Para pensar</div>
            <div class="chip" data-filter="acalmar">Para acalmar</div>
            <div class="chip" data-filter="ensino">Ensino & ReferÃªncia</div>
            <div class="chip" data-filter="poesia">Poesia</div>
          </div>
        </div>
      </div>

      <aside class="hero-aside" aria-hidden="true">
        <div style="display:flex;gap:12px;align-items:center">
          <img src="https://livrariaprometeu.com/01_SITE/assets/img/hero-ebooks.webp" alt="" style="width:78px;height:110px;object-fit:cover;border-radius:8px" loading="lazy">
          <div>
            <div class="stat" id="featuredTitle">Descubra algo novo</div>
            <div class="micro" style="margin-top:6px">Clique em <strong>Surpreenda-me</strong> para ver um destaque e ler um trecho.</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="micro"><strong>Favoritos</strong></div>
          <div id="favList" style="margin-top:8px;color:var(--muted)">Nenhum ainda â€” salve capas que gostar.</div>
        </div>
      </aside>
    </section>

    <!-- Curadoria -->
    <section aria-label="Curadoria Prometeu">
      <h2 style="margin:8px 0">Curadorias rÃ¡pidas</h2>
      <div class="curation" id="curationStrip" aria-hidden="false"></div>
    </section>

    <!-- Grid de ebooks -->
    <section id="ebooks">
      <div id="ebookGrid" class="grid" aria-live="polite"></div>
      <div style="text-align:center;margin-top:18px">
        <button id="loadMore" class="btn btn-ghost" style="display:none">Carregar mais</button>
      </div>
    </section>

    <p style="margin-top:28px" class="micro">Baixe, leia, compartilhe â€” o conhecimento pertence a quem o cultiva.</p>

    <!-- RecomendaÃ§Ãµes de artigos -->
    <section>
      <h2 style="margin-bottom:16px">Leituras recomendadas</h2>
      <div class="grid" id="articleGrid">
        <!-- Cards via JS -->
      </div>
    </section>
    <div id="curation"></div>
  </main>

  <!-- Modal CinemÃ¡tico -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitleDesc">
      <button class="close-btn" id="closeModal" aria-label="Fechar">âœ•</button>
      <div id="modalCover"></div>

      <div class="modal-content">
        <h3 id="modalTitle"></h3>
        <div id="modalAuthor" class="modal-micro"></div>
        <div id="modalTags" class="tags" aria-hidden="true"></div>
        <div id="modalMeta" class="modal-micro"></div>
        <div id="modalExcerpt" class="modal-excerpt"></div>

        <div class="modal-actions">
          <a id="modalDownload" class="btn btn-primary" target="_blank" rel="noopener" style="text-decoration:none;text-align:center">Ler / Baixar</a>
          <button id="modalSave" class="btn btn-ghost">Salvar</button>
          <button id="shareBtn" class="btn btn-ghost">Compartilhar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">AÃ§Ã£o realizada</div>

  <script>
    // SALVA LIVRO
    function salvarLivro(livro) {
      // recupera os jÃ¡ salvos
      const livros = JSON.parse(localStorage.getItem('meusLivros')) || [];
      // adiciona o novo
      livros.push(livro);
      // salva novamente
      localStorage.setItem('meusLivros', JSON.stringify(livros));

      // emite um evento para o header reagir
      window.dispatchEvent(new Event('livrosAtualizados'));
    }
    
    // CONFIG
    const JSON_URL = 'https://livrariaprometeu.com/livros/ebooks.json'; // ajuste se preciso
    let ebooks = [];
    let shown = 0;
    const PAGE_SIZE = 9;
    let activeFilter = 'all';
    const favoritesKey = 'prometeu_favs_v1';

    // HELPERS DOM
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = msg => {
      const t = $('#toast');
      t.textContent = msg;
      t.style.display = 'block';
      setTimeout(()=> t.style.display='none', 1600);
    };

    // FETCH JSON
    fetch(JSON_URL)
      .then(r => r.json())
      .then(data => {
        ebooks = Array.isArray(data) ? data : (data.items || []);
        $('#totalCount').textContent = ebooks.length;
        buildCurationStrip();
        renderInitial();
        restoreFavoritesUI();
      })
      .catch(err => {
        console.error('erro ao carregar ebooks', err);
        $('#ebookGrid').innerHTML = '<p style="color:var(--muted)">Erro ao carregar a coleÃ§Ã£o.</p>';
      });

    // CURATION STRIP
    function buildCurationStrip(){
      const strip = $('#curationStrip');
      if(!strip) return;
      strip.innerHTML = '';
      const picks = ebooks.slice(0, 12);
      picks.forEach(e => {
        const node = document.createElement('div');
        node.className = 'card-small';
        node.innerHTML = `<img src="${e.capa}" alt="${escapeHtml(e.titulo)}" loading="lazy"><div><strong style="display:block">${e.titulo}</strong><span class="micro">${e.autor||''}</span></div>`;
        node.onclick = () => openModal(e);
        strip.appendChild(node);
      });
    }

    // RENDER / PAGINAÃ‡ÃƒO
    function renderInitial(){
      shown = 0;
      $('#ebookGrid').innerHTML = '';
      renderMore();
    }

    function renderMore(){
      const grid = $('#ebookGrid');
      const filtered = applyFilterSearch();
      const slice = filtered.slice(shown, shown + PAGE_SIZE);
      slice.forEach(e => grid.appendChild(bookCard(e)));
      shown += slice.length;
      $('#loadMore').style.display = (shown < filtered.length) ? 'inline-block' : 'none';
    }

    $('#loadMore').addEventListener('click', renderMore);

    // CRIA CARD
    function bookCard(e){
      const card = document.createElement('article');
      card.className = 'card tooltip';
      const excerpt = e.excerpt ? e.excerpt.slice(0,220) + (e.excerpt.length>220?'â€¦':'') : 'â€”';

      card.innerHTML = `
        <div class="img-wrap"><img src="${e.capa}" alt="Capa ${escapeHtml(e.titulo)}" loading="lazy"></div>
        <div class="title">${e.titulo}</div>
        <div class="author">${e.autor || ''}</div>
        <div class="meta">
          <div style="color:var(--muted);font-size:0.95rem">${e.idioma || '-'}</div>
          <div style="font-size:0.9rem;color:var(--muted)">${e.tamanho || '-'}</div>
        </div>
        <div class="actions">
          <button class="btn-small btn-open" data-id="${e.id}" aria-label="Abrir ${e.titulo}" style="background-color:var(--accent);color:var(--paper);">Comprar na Amazon</button>
          ${e.arquivo.url ? `<a class="btn-small" href="${e.arquivo.url}" target="_blank" rel="noopener" style="color:var(--accent);">Ler Gratuitamente</a>` : ''}
          <button class="btn-small save-btn" data-id="${e.id}" aria-label="Salvar ${e.titulo}" style="color:var(--accent);">â™¥</button>
        </div>
        <div class="tip">${escapeHtml(excerpt)}</div>
      `;

      // abrir modal ao clicar no card (ou no botÃ£o Abrir)
      card.querySelector('.btn-open').addEventListener('click', (ev) => { ev.stopPropagation(); openModal(e); });
      card.addEventListener('click', () => openModal(e));

      // salvar favorito (botÃ£o)
      card.querySelector('.save-btn').addEventListener('click', (ev) => {
        ev.stopPropagation();
        toggleFavorite(e);
      });

      return card;
    }

    // OPEN MODAL (cinemÃ¡tico)
    function openModal(e){
      const modal = $('#modal');
      // capa
      $('#modalCover').innerHTML = `<img src="${e.capa}" alt="${escapeHtml(e.titulo)}">`;
      // textos
      $('#modalTitle').textContent = e.titulo;
      $('#modalAuthor').textContent = e.autor || '';
      $('#modalMeta').textContent = `${e.categoria || '-'} â€¢ ${e.idioma || '-'} â€¢ ${e.tamanho || '-'}`;
      // tags
      const tagContainer = $('#modalTags');
      tagContainer.innerHTML = (e.tags && e.tags.length) ? e.tags.map(t => `<span class="chip">${t}</span>`).join('') : '';
      // excerpt
      $('#modalExcerpt').innerHTML = e.descricao ? `<em>${escapeHtml(e.descricao)}</em>` : '<div class="micro">Sem trecho disponÃ­vel</div>';
      // download
      const downloadBtn = $('#modalDownload');

      if (e.arquivo && e.arquivo.downloadDisponivel && e.arquivo.url) {
        downloadBtn.href = e.arquivo.url;
        downloadBtn.textContent = 'Ler';
      } else if (e.linkAmazon) {
        downloadBtn.href = e.linkAmazon;
        downloadBtn.textContent = 'Comprar na Amazon';
      } else {
        downloadBtn.href = '#';
        downloadBtn.textContent = 'IndisponÃ­vel';
      }

      // salvar
      $('#modalSave').onclick = () => { toggleFavorite(e); updateModalSaveState(e); };
      updateModalSaveState(e);

      // compartilhar
      $('#shareBtn').onclick = () => {
        const url = e.fileDownload || e.linkamz || window.location.href;
        if(navigator.share){
          navigator.share({titulo: e.titulo, text: e.excerpt || '', url});
        } else {
          copyToClipboard(url);
          toast('Link copiado para a Ã¡rea de transferÃªncia');
        }
      };

      // exibir modal
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      // update featured title in aside
      $('#featuredTitle').textContent = e.titulo;
    }

    // fechar modal
    $('#closeModal').addEventListener('click', closeModal);
    $('#modal').addEventListener('click', (ev) => { if (ev.target.id === 'modal') closeModal(); });
    function closeModal(){
      const modal = $('#modal');
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    // BUSCA E FILTROS
    $('#q').addEventListener('input', () => { shown = 0; $('#ebookGrid').innerHTML=''; renderMore(); });
    $('#clearSearch').addEventListener('click', () => { $('#q').value=''; shown=0; $('#ebookGrid').innerHTML=''; renderMore(); });

    $$('.chip').forEach(ch => ch.addEventListener('click', ev => {
      $$('.chip').forEach(c => c.style.borderColor='#eee');
      ev.currentTarget.style.borderColor = 'var(--accent)';
      activeFilter = ev.currentTarget.dataset.filter;
      shown = 0; $('#ebookGrid').innerHTML=''; renderMore();
    }));

    function applyFilterSearch(){
      const q = $('#q').value.trim().toLowerCase();
      let list = ebooks.slice();

      if (activeFilter && activeFilter !== 'all'){
        list = list.filter(e =>
          (e.tags && e.tags.includes(activeFilter)) ||
          (e.categoria && e.categoria.toLowerCase().includes(activeFilter))
        );
      }

      if (q){
        list = list.filter(e =>
        (e.titulo && e.titulo.toLowerCase().includes(q)) ||
        (e.autor && e.autor.toLowerCase().includes(q)) ||
        (e.categoria && e.categoria.toLowerCase().includes(q)) ||
        (e.excerpt && e.excerpt.toLowerCase().includes(q))
      );
      }

      // destaque first if exists
      list.sort((a,b) => (b.destaque?1:0) - (a.destaque?1:0));
      return list;
    }

    // SURPREENDA-ME
    $('#surpriseBtn').addEventListener('click', () => {
      if (!ebooks.length) return;
      const idx = Math.floor(Math.random() * ebooks.length);
      const e = ebooks[idx];
      window.scrollTo({top: $('#ebooks').offsetTop - 80, behavior:'smooth'});
      setTimeout(()=> openModal(e), 500);
    });

    // EXPLORE
    $('#exploreBtn').addEventListener('click', () => {
      window.scrollTo({top: $('#ebooks').offsetTop - 30, behavior:'smooth'});
    });

    // FAVORITOS (localStorage)
    function getFavs(){ try { return JSON.parse(localStorage.getItem(favoritesKey) || '[]'); } catch { return []; } }
    function saveFavs(arr){ localStorage.setItem(favoritesKey, JSON.stringify(arr)); }

    function toggleFavorite(e){
      const favs = getFavs();
      const existsIdx = favs.findIndex(a => a.id === e.id);
      if (existsIdx > -1){
        favs.splice(existsIdx,1);
        saveFavs(favs);
        toast('Removido dos favoritos');
      } else {
        favs.unshift({id: e.id, title: e.title, cover: e.cover});
        saveFavs(favs);
        toast('Adicionado aos favoritos');
      }
      restoreFavoritesUI();
      updateSaveButtons();
    }

    function restoreFavoritesUI(){
      const wrap = $('#favList');
      const favs = getFavs();
      if (!favs.length){ wrap.textContent = 'Nenhum ainda â€” salve capas que gostar.'; return; }
      wrap.innerHTML = favs.slice(0,6).map(f => `<div style="display:inline-block;margin-right:8px"><img src="${f.cover}" alt="${escapeHtml(f.title)}" style="width:34px;height:50px;object-fit:cover;border-radius:4px"></div>`).join('');
    }

    function updateModalSaveState(e){
      const favs = getFavs();
      const exists = favs.find(a => a.id === e.id);
      $('#modalSave').textContent = exists ? 'Remover' : 'Salvar';
    }

    function updateSaveButtons(){
      $$('.save-btn').forEach(btn => {
        const id = Number(btn.dataset.id);
        const exists = getFavs().some(f => f.id === id);
        btn.textContent = exists ? 'âœ“' : 'â™¥';
      });
    }

    // Helpers
    function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function copyToClipboard(text){ navigator.clipboard?.writeText(text).catch(()=>{}); }

    // Render all immediate (utility)
    function renderAllCardsImmediately(){
      const grid = $('#ebookGrid');
      grid.innerHTML = '';
      ebooks.forEach(e => grid.appendChild(bookCard(e)));
    }

    // Observe grid changes to update save buttons
    const observer = new MutationObserver(() => setTimeout(updateSaveButtons, 300));
    observer.observe(document.getElementById('ebookGrid'), { childList: true, subtree: true });

    // Keyboard accessibility: Esc fecha modal
    document.addEventListener('keydown', (ev) => { if(ev.key === 'Escape') closeModal(); });


    // CARREGAR ARTIGOS
    let artigo = [];

    fetch('https://livrariaprometeu.com/blog/artigos.json')
      .then(res => res.json())
      .then(data => {
        artigo = data;
        renderArtigos();
      });

    function renderArtigos() {
      const grid = document.getElementById('articleGrid');

      artigo.slice(0, 3).forEach(e => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <a href="${e.file || 'https://livrariaprometeu.com/em-breve.html'}" class="link" style="text-decoration:none">
            <div class="img-wrap"><img src="${e.cover}" alt="Capa ${e.title || 'Arquivo sem imagem configurada'}"></div>
            <div class="texto" style="padding:20px">
              <div class="title" style="color:var(--ink)">${e.title || 'Arquivo sem titulo configurado'}</div>
              <div class="resumo" style="color:var(--muted)">${e.summary || 'Arquivo sem resumo configurado'}</div>
              <div class="rodape-artigo" style="display:flex;color:var(--muted)">
                <div class="categoria">${e.category || 'NÃ£o definida'}</div>
                <div class="separador" style="padding:0px 10px">|</div>
                <div class="data" style="display:flex;align-self:end">${e.date || 'NÃ£o informada'}</div>
              </div>
            </div>
          </a>
        `;
        grid.appendChild(card);

        const small = document.createElement('div');
        small.className = 'card-small';
        small.innerHTML = `<img src="${e.cover}" alt=""><div><strong style="display:block">${e.title}</strong><span style="color:var(--muted);font-size:0.92rem">${e.author}</span></div>`;
      });
    }
  </script>
</body>
</html>





















